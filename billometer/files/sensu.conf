{%- from "billometer/map.jinja" import server with context -%}
{%- set bill_user = server:message_queue:user') %}
{%- set bill_pass = server:message_queue:password') %}
{% if grains.ipv4[0] == '127.0.0.1' %}{% set address =  grains.ipv4[1] %}{% else %}{% set address =  grains.ipv4[0] %}{% endif %}
remote_rabbitmq_billometer_alive:
  command: "PATH=$PATH:/etc/sensu/plugins rabbitmq-amqp-alive.rb -w {{ address }} -v %2Fbillometer -u {{ bill_user }} --password {{ bill_pass }}"
  interval: 60
  occurrences: 1
  subscribers:
  - remote-network